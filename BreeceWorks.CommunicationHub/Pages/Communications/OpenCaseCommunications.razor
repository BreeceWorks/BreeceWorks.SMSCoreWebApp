@page "/opencasecommunications"

<h3>Case Communications</h3>
<script type="text/javascript">

    EndOfList = () => {
        var lastChild = document.getElementById("MessageList").lastChild;
        lastChild.parentNode.parentNode.scrollTop = lastChild.offsetTop - lastChild.parentNode.parentNode.offsetTop;
    }
</script>
<div>
    <button @onclick="GoToBottomOfList">Go to bottom of list</button>
</div>
@if (caseTranscript == null)
{
    <p><em>Loading...</em></p>
}
else
{ @if (Error != String.Empty)
    {
        <p style="color:red"><em>@Error</em></p>
    }
    <div style="height: 500px; overflow:auto;">
        <ul id="MessageList">
            @if (caseTranscript.Messages != null)
            {
                foreach (BreeceWorks.Shared.CaseObjects.Message message in caseTranscript.Messages)
                {
                    <li>
                        <table>
                            <tr>
                                <td>
                                    <table>
                                        <tr>
                                            <td><b>Type: </b>@message.Type   </td>
                                            <td></td>
                                            <td><b>Formatting: </b>@message.Formatting    </td>
                                            <td></td>
                                            <td><b>Source: </b>@message.ChannelSource   </td>
                                            <td> </td>
                                            <td><b>Status: </b>@message.Status</td>
                                            <td></td>
                                            <td><b>Created At: </b>@message.CreatedAt</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            @if (message.Author != null)
                            {
                                <tr>
                                    <td>
                                        <table>
                                            <tr>
                                                <td><b>Author Type: </b>@message.Author.Role</td>
                                                <td></td>
                                                <td><b>Name: </b>@message.Author.Profile.FirstName @message.Author.Profile.LastName</td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            }
                            <tr>
                                <td>
                                    <table>
                                        <tr>
                                            <td><b>Message: </b>@message.Data</td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            @if (message.MessageAttachments != null && message.MessageAttachments.Count > 0)
                            {
                                <tr><td>Attachment(s) Included</td></tr>
                                <tr><td> </td></tr>
                                foreach (BreeceWorks.Shared.CaseObjects.MessageAttachment messageAttachment in message.MessageAttachments)
                                {
                                    <tr>
                                        <td>
                                            <table>
                                                <tr>
                                                    <td>
                                                        Type: @messageAttachment.ContentType
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <a href="@String.Format("{0}/api/SMSAttachment/attachment-download/{1}", SMSCoreWebApi ,messageAttachment.Id)" target="_blank">@messageAttachment.Name@messageAttachment.Extension</a>
                                                    </td>                                                
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                }
                            }
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                            <tr><td> </td></tr>
                        </table>
                    </li>
                }
            }
        </ul>
    </div>
}
